# YOLO 图像缩放原理：Letterbox（信箱模式）技术

YOLO 模型（如 YOLOv11）通常需要固定的输入尺寸，通常为 **640x640**。然而，大多数摄像头或 RTSP 流的分辨率是 **1920x1080** (16:9)。

YOLO 并不会简单地拉伸图像，因为拉伸会导致物体变形（例如让人看起来变胖或变瘦），从而降低检测精度。相反，它使用了一种称为 **Letterbox（信箱模式）** 的技术。

## 1. 核心三个步骤

假设你有一张 **1280x720** 的原始图片，想要将其缩放到 **640x640**。

### 步骤 A：保持宽高比缩放
模型计算宽度和高度的缩放比例，并选择**较小**的一个。
- 宽度缩放：640 / 1280 = 0.5
- 高度缩放：640 / 720 = 0.88
- **采用比例**：0.5
- **缩放后尺寸**：640 x 360（比例完美保持，但还不是正方形）。

### 步骤 B：居中与填充 (Padding)
为了达到 640x640 的正方形，模型会添加填充像素（通常是灰色，颜色值为 `(114, 114, 114)`）。
- **目标高度**：640
- **当前高度**：360
- **总缺口**：280 像素
- **左右填充**：上边缘填充 140 像素，下边缘填充 140 像素。

### 步骤 C：归一化 (Normalization)
最后，将像素值除以 255.0，将范围从 `[0, 255]` 转换到 `[0, 1]` 以供神经网络处理。

---

## 2. 为什么不直接物理缩放/拉伸？

| 方法 | 视觉结果 | 对 AI 的影响 |
| :--- | :--- | :--- |
| **拉伸 (Stretch)** | 物体变形（变宽或变长） | **精度下降**：破坏了物体的几何特征（如长宽比）。 |
| **裁剪 (Crop)** | 边缘信息丢失 | **存在风险**：可能会丢失位于屏幕边缘的目标。 |
| **Letterbox** | 原始比例完美保留 | **精度最高**：物体几何特征完整，检测效果最稳。 |

---

## 3. 如何映射回原始坐标？

当模型在 **640x640** 的处理图中检测到鼻子位于 `(320, 200)` 时，它会自动进行反向计算，将坐标映射回你的 **1920x1080** 原始图中：

1.  **去除填充**：减去那 140 像素的灰色边框。
2.  **反向缩放**：将坐标除以 0.5 的缩放比例。

**Ultralytics YOLO 会自动完成这些数学运算**。你在 JSON 文件中看到的坐标已经是经过映射还原的原始像素坐标。

---

## 4. 进阶技巧：矩形推理 (Rectangular Inference)
在现代 YOLO 中，如果你正在处理一批相同比例（如 16:9）的图，模型可以使用“矩形推理”来减少灰色填充物，从而提高处理速度（最高可提升 30%）。它会处理如 640x384 的长方形，而不是浪费计算资源在全黑/全灰的 640x640 正方形上。
