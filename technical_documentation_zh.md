# YOLOv11 姿态检测项目技术文档

## 1. 项目概述
本项目基于 **YOLOv11** 模型实现了一套鲁棒的人体姿态估计系统。项目提供了两种主要的交互界面：
- **Web 界面**：基于 Gradio 的交互式 Demo，适用于高质量的单帧图像分析。
- **实时视频流**：基于 OpenCV 的脚本，提供低延迟的实时姿态估计。
- **对象追踪**：集成 ByteTrack 算法，实现对人、**瓶子**及其他目标的持久化 ID 追踪。

---

## 2. 系统架构

### 2.1 模型规范
- **模型文件**：`yolo11n-pose.pt`（用于姿态）和 `yolo11n.pt`（用于通用追踪）。
- **任务类型**：姿态估计与通用对象检测/追踪。
- **输出内容**：17 个关键点（姿态）或带有唯一 ID 的检测框（追踪）。

### 2.2 核心组件

#### A. Web 演示端 (`pose_demo.py`)
- **前端框架**：Gradio Blocks。
- **图像处理**：PIL (Python Imaging Library)。
- **交互控制**：支持通过 UI 滑块实时调整置信度（Confidence）和交并比（IoU）阈值。
- **工作流**：
  1. 拍摄照片或上传图像。
  2. 将图像发送至 YOLO 模型。
  3. 使用 Ultralytics 的 `Annotator` 绘制骨骼点。
  4. 将处理后的图像返回给用户。

#### B. 实时视频流 (`live_pose.py`)
- **引擎**：OpenCV (cv2)。
- **性能优化**：采用 `predict()` 模式替代 `track()`，以减少对第三方库（如 `lap`）的依赖，确保基础姿态检测的高帧率。

#### C. 对象追踪 (`live_track.py`)
- **算法**：ByteTrack。
- **核心功能**：为检测到的目标（如瓶子、人等）分配唯一 ID。
- **使用模型**：`yolo11n.pt`（通用检测模型）。
- **依赖说明**：需要安装 `lapx` 或 `lap` 库。

---

## 3. 数据格式与处理

### 3.1 输入格式
系统通过 OpenCV 从摄像头捕获原始像素数据：
- **颜色空间**：BGR (蓝-绿-红)。
- **数据结构**：形状为 `(高度, 宽度, 3)` 的 NumPy `ndarray`。
- **预处理**：YOLO 会自动将输入帧调整为标准尺寸（默认 `640x640`），并使用填充（letterboxing）保持长宽比。

### 3.2 检测输出
针对每一帧，模型返回 `Results` 对象，包含：
- **检测框 (Boxes)**：检测到的人体坐标 `(x1, y1, x2, y2)`。
- **关键点 (Keypoints)**：标准 COCO 17 点坐标（眼睛、耳朵、鼻子、肩膀、肘部、手腕、臀部、膝盖、脚踝）。
- **置信度**：针对检测框和每个关键点的概率得分。

### 3.3 可视化流程
1. **渲染**：使用 `results[0].plot()` 方法。
2. **颜色空间处理**：
   - `pose_demo.py`：将 BGR 转换为 RGB 以适配 Gradio 显示。
   - `live_pose.py`：直接使用 BGR 渲染，以获得最佳 OpenCV 显示性能。

---

## 4. 实现细节对比

| 功能特性 | Web 演示 (`pose_demo`) | 实时流 (`live_pose`) |
| :--- | :--- | :--- |
| **帧率 (FPS)** | 较低 (捕获后处理) | 极高 (原生流处理) |
| **底层库** | Gradio | OpenCV |
| **输出类型** | 静态结果图 | 实时视频窗口 |
| **适用场景** | 详细分析、截图保存 | 交互式实时测试 |

### 4.2 错误处理
- **模型自动获取**：自动检查本地路径，若缺失则从 Ultralytics 官方服务器下载。
- **空帧保护**：严格检查 `img is None` 情况，防止视频流中断导致程序崩溃。
- **无目标处理**：若未检测到人体，则返回原始帧，保持视频流连续性。

---

## 5. 项目结构
- `yolo-project/`：根目录。
  - `models/`：存放 `.pt` 模型权重文件。
  - `scripts/`：辅助工具脚本。
  - `pose_demo.py`：Gradio 交互界面主程序。
  - `live_track.py`：ByteTrack 追踪集成程序。
  - `my_bytetrack.yaml`：自定义追踪配置及调整指南。

---

## 6. 高级追踪调优
如果追踪效果不理想，您可以修改 `my_bytetrack.yaml` 文件。

### 常见场景调优：
- **ID 频繁跳变 (Flickering)**：减小 `track_low_thresh`。
- **物体被遮挡后丢失 ID**：增大 `track_buffer`。
- **不同物体间 ID 错误交换**：减小 `match_thresh`。
- **出现虚假/幽灵 ID**：增大 `new_track_thresh`。
  - `technical_documentation.md`：英文技术文档。
  - `technical_documentation_zh.md`：中文技术文档。
